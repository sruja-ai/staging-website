const y=["capacity.instanceType","capacity.instanceProvider","capacity.readReplicas","capacity.cache","obs.metrics.application","obs.alerting.critical","obs.logging.application","obs.tracing.tool","obs.tracing.sampleRate","compliance.pci.level","compliance.pci.status","compliance.soc2.type","compliance.gdpr.status","cost.monthly.total","cost.monthly.compute","cost.perTransaction.average"];function v(e,s,t){if(typeof e!="string"||e.length===0||typeof s!="number"||s<1||!Number.isInteger(s))return!1;const i=e.split(/\r?\n/),n=s-1;if(n<0||n>=i.length)return!1;let r=0;for(let a=n;a>=0;a--){const c=i[a],o=c.trim();if(!o||o.startsWith("//")||o.startsWith("#"))continue;const l=(c.match(/\}/g)||[]).length;r+=l;const m=(c.match(/\{/g)||[]).length;r-=m;const u=new RegExp(`\\b${t}\\b`,"i").test(o),f=c.includes("{");if(u){if(f){if(r<0||r===0&&a===n)return!0}else if(r<0)return!0}else if(f&&["properties","metadata","checks","views","model","specification","element","system","container","component","deployment"].some(p=>p!==t&&new RegExp(`\\b${p}\\b`,"i").test(o))&&r<0)return!1}return!1}function g(e){return typeof window>"u"?null:window[e]}function w(){return{async getDiagnostics(e){const s=g("sruja_get_diagnostics");if(!s)return[];try{const t=s(e);if(!t||!t.ok)return[];const i=JSON.parse(t.data);return Array.isArray(i)?i:[]}catch(t){return console.warn("WASM getDiagnostics failed:",t),[]}},async getSymbols(e){const s=g("sruja_get_symbols");if(!s)return[];try{const t=s(e);if(!t||!t.ok)return[];const i=JSON.parse(t.data);return Array.isArray(i)?i:[]}catch(t){return console.warn("WASM getSymbols failed:",t),[]}},async hover(e,s,t){const i=g("sruja_hover");if(!i)return null;try{const n=i(e,s,t);return!n||!n.ok||!n.data||n.data==="null"?null:JSON.parse(n.data)}catch(n){return console.warn("WASM hover failed:",n),null}},async completion(e,s,t){const i=g("sruja_completion");if(!i)return[];try{const n=i(e,s,t);if(!n||!n.ok)return[];const r=JSON.parse(n.data);return Array.isArray(r)?r:[]}catch(n){return console.warn("WASM completion failed:",n),[]}},async goToDefinition(e,s,t){const i=g("sruja_go_to_definition");if(!i)return null;try{const n=i(e,s,t);return!n||!n.ok||!n.data||n.data==="null"?null:JSON.parse(n.data)}catch(n){return console.warn("WASM goToDefinition failed:",n),null}},async format(e){const s=g("sruja_format");if(!s)return e;try{const t=s(e);return!t||!t.ok?e:t.data}catch(t){return console.warn("WASM format failed:",t),e}}}}function N(e,s,t){const i={provideDiagnostics:async r=>{const a=r.getValue(),o=(await t.getDiagnostics(a)).map(l=>({severity:l.severity==="Error"?e.MarkerSeverity.Error:l.severity==="Warning"?e.MarkerSeverity.Warning:e.MarkerSeverity.Info,message:l.message,startLineNumber:l.location.line,startColumn:l.location.column,endLineNumber:l.location.line,endColumn:l.location.column+10,code:l.code}));e.editor.setModelMarkers(r,"sruja-wasm",o)}};s.onDidChangeModelContent(()=>{const r=s.getModel();r&&i.provideDiagnostics(r)});const n=s.getModel();n&&i.provideDiagnostics(n),e.languages.registerHoverProvider("sruja",{provideHover:async(r,a)=>{const c=r.getValue(),o=await t.hover(c,a.lineNumber,a.column);return o?{range:new e.Range(a.lineNumber,a.column,a.lineNumber,a.column),contents:[{value:o.contents}]}:null}}),e.languages.registerCompletionItemProvider("sruja",{provideCompletionItems:async(r,a)=>{const c=r.getValue(),o=await t.completion(c,a.lineNumber,a.column),l=r.getWordUntilPosition(a),m=new e.Range(a.lineNumber,l.startColumn,a.lineNumber,l.endColumn),d=o.map(u=>({label:u.label,kind:e.languages.CompletionItemKind.Keyword,insertText:u.label,range:m}));if(v(c,a.lineNumber,"properties")){const u=y.map(f=>({label:f,kind:e.languages.CompletionItemKind.Property,insertText:f,range:m}));d.push(...u)}return{suggestions:d}}}),e.languages.registerDefinitionProvider("sruja",{provideDefinition:async(r,a)=>{const c=r.getValue(),o=await t.goToDefinition(c,a.lineNumber,a.column);return o?[{uri:r.uri,range:new e.Range(o.line,o.column,o.line,o.column+10)}]:[]}}),e.languages.registerDocumentFormattingEditProvider("sruja",{provideDocumentFormattingEdits:async r=>{const a=r.getValue(),c=await t.format(a);return[{range:r.getFullModelRange(),text:c}]}})}export{w as createWasmLspApi,N as initializeMonacoWasmLsp};
