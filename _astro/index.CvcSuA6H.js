const p=["capacity.instanceType","capacity.instanceProvider","capacity.readReplicas","capacity.cache","obs.metrics.application","obs.alerting.critical","obs.logging.application","obs.tracing.tool","obs.tracing.sampleRate","compliance.pci.level","compliance.pci.status","compliance.soc2.type","compliance.gdpr.status","cost.monthly.total","cost.monthly.compute","cost.perTransaction.average"];function y(e,a,t){if(typeof e!="string"||e.length===0||typeof a!="number"||a<1||!Number.isInteger(a))return!1;const i=e.split(/\r?\n/),n=a-1;if(n<0||n>=i.length)return!1;let r=0,s=!1;const c=new RegExp(`\\b${t}\\s*\\{`,"i");for(let o=n;o>=0;o--){const l=i[o]||"",f=l.trim(),d=(l.match(/\}/g)||[]).length;r+=d;const u=(l.match(/\{/g)||[]).length;if(r-=u,c.test(f))return r<=1;if(r<0&&!s&&(s=!0,r<0))return!1}return!1}function g(e){return typeof window>"u"?null:window[e]}function v(){return{async getDiagnostics(e){const a=g("sruja_get_diagnostics");if(!a)return[];try{const t=a(e);if(!t||!t.ok)return[];const i=JSON.parse(t.data);return Array.isArray(i)?i:[]}catch(t){return console.warn("WASM getDiagnostics failed:",t),[]}},async getSymbols(e){const a=g("sruja_get_symbols");if(!a)return[];try{const t=a(e);if(!t||!t.ok)return[];const i=JSON.parse(t.data);return Array.isArray(i)?i:[]}catch(t){return console.warn("WASM getSymbols failed:",t),[]}},async hover(e,a,t){const i=g("sruja_hover");if(!i)return null;try{const n=i(e,a,t);return!n||!n.ok||!n.data||n.data==="null"?null:JSON.parse(n.data)}catch(n){return console.warn("WASM hover failed:",n),null}},async completion(e,a,t){const i=g("sruja_completion");if(!i)return[];try{const n=i(e,a,t);if(!n||!n.ok)return[];const r=JSON.parse(n.data);return Array.isArray(r)?r:[]}catch(n){return console.warn("WASM completion failed:",n),[]}},async goToDefinition(e,a,t){const i=g("sruja_go_to_definition");if(!i)return null;try{const n=i(e,a,t);return!n||!n.ok||!n.data||n.data==="null"?null:JSON.parse(n.data)}catch(n){return console.warn("WASM goToDefinition failed:",n),null}},async format(e){const a=g("sruja_format");if(!a)return e;try{const t=a(e);return!t||!t.ok?e:t.data}catch(t){return console.warn("WASM format failed:",t),e}}}}function b(e,a,t){const i={provideDiagnostics:async r=>{const s=r.getValue(),o=(await t.getDiagnostics(s)).map(l=>({severity:l.severity==="Error"?e.MarkerSeverity.Error:l.severity==="Warning"?e.MarkerSeverity.Warning:e.MarkerSeverity.Info,message:l.message,startLineNumber:l.location.line,startColumn:l.location.column,endLineNumber:l.location.line,endColumn:l.location.column+10,code:l.code}));e.editor.setModelMarkers(r,"sruja-wasm",o)}};a.onDidChangeModelContent(()=>{const r=a.getModel();r&&i.provideDiagnostics(r)});const n=a.getModel();n&&i.provideDiagnostics(n),e.languages.registerHoverProvider("sruja",{provideHover:async(r,s)=>{const c=r.getValue(),o=await t.hover(c,s.lineNumber,s.column);return o?{range:new e.Range(s.lineNumber,s.column,s.lineNumber,s.column),contents:[{value:o.contents}]}:null}}),e.languages.registerCompletionItemProvider("sruja",{provideCompletionItems:async(r,s)=>{const c=r.getValue(),o=await t.completion(c,s.lineNumber,s.column),l=r.getWordUntilPosition(s),f=new e.Range(s.lineNumber,l.startColumn,s.lineNumber,l.endColumn),d=o.map(u=>({label:u.label,kind:e.languages.CompletionItemKind.Keyword,insertText:u.label,range:f}));if(y(c,s.lineNumber,"properties")){const u=p.map(m=>({label:m,kind:e.languages.CompletionItemKind.Property,insertText:m,range:f}));d.push(...u)}return{suggestions:d}}}),e.languages.registerDefinitionProvider("sruja",{provideDefinition:async(r,s)=>{const c=r.getValue(),o=await t.goToDefinition(c,s.lineNumber,s.column);return o?[{uri:r.uri,range:new e.Range(o.line,o.column,o.line,o.column+10)}]:[]}}),e.languages.registerDocumentFormattingEditProvider("sruja",{provideDocumentFormattingEdits:async r=>{const s=r.getValue(),c=await t.format(s);return[{range:r.getFullModelRange(),text:c}]}})}export{v as createWasmLspApi,b as initializeMonacoWasmLsp};
