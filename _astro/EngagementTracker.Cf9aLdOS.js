import{r as l}from"./index._4BMK3ry.js";import{c as s}from"./storage.3RYs70yn.js";function h(){const o=l.useRef(0);return l.useEffect(()=>{const a=s("sruja-last",""),r=s("sruja-xp","0"),e=s("sruja-streak","0"),p=new Set(["page.view","tutorial.diagram_show","tutorial.open_designer","quiz.view","quiz.complete"]);try{const t=new CustomEvent("sruja:engagement",{detail:{xp:parseInt(r.get()||"0",10),streak:parseInt(e.get()||"0",10),last:a.get()||""}});window.dispatchEvent(t)}catch(t){console.warn("engagement init dispatch failed",t)}const i=t=>{const c=Date.now();if(c-o.current<5e3)return;const g=new Date,u=a.get(),d=t.detail&&t.detail.type||"";if(!p.has(d))return;const w=parseInt(r.get()||"0",10)+1;if(r.set(String(w)),u){const n=new Date(u);if(Math.floor((g.getTime()-n.getTime())/864e5)>=1){const f=parseInt(e.get()||"0",10)+1;e.set(String(f))}}else e.set("1");a.set(g.toISOString()),o.current=c;try{const n=new CustomEvent("sruja:engagement",{detail:{xp:parseInt(r.get()||"0",10),streak:parseInt(e.get()||"0",10),last:a.get()||""}});window.dispatchEvent(n)}catch(n){console.warn("engagement update dispatch failed",n)}};return window.addEventListener("sruja:event",i),()=>window.removeEventListener("sruja:event",i)},[]),null}export{h as default};
