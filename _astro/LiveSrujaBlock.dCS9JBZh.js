import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.DM7nOceM.js";import"./PosthogProvider.DT9wrO5O.js";import{h as k,a as S,l as C}from"./wasmAdapter.DXXc9gb7.js";/* empty css                       */import{S as E}from"./SrujaLoader.lh90-mjg.js";import{t as L,a as w}from"./analytics.BQrN3n26.js";import{L as z,aU as I,aV as M}from"./index.DUEk397o.js";import"./index.DtZLTQNg.js";import"./preload-helper.BlTxHScW.js";import"./posthog.Dnn64KkL.js";import"./errorTracking.BjsNxNnG.js";class R extends s.Component{constructor(n){super(n),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidUpdate(n){n.viewId!==this.props.viewId&&this.state.hasError&&this.setState({hasError:!1,error:null})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-secondary)",fontSize:14,padding:"2rem",textAlign:"center"},children:e.jsxs("div",{children:[e.jsxs("p",{children:["Failed to render view ",'"',this.props.viewId,'"']}),this.state.error?.message&&e.jsx("p",{style:{fontSize:12,marginTop:"0.5rem",color:"var(--color-text-tertiary)"},children:this.state.error.message})]})}):this.props.children}}function $({model:t,viewId:n="index"}){const i=s.useMemo(()=>t.views?Object.keys(t.views):[],[t]),[c,v]=s.useState(null),l=s.useMemo(()=>c&&i.includes(c)?c:n&&i.includes(n)?n:i.length>0?i[0]:"index",[c,n,i]),u=s.useMemo(()=>{const o=Object.keys(t.elements||{}).length,d=(t.relations||[]).length;return{elements:o,relations:d}},[t]),h=s.useMemo(()=>{const o=t.elements||{},d=new Set(Object.keys(o)),j=(t.relations||[]).filter(r=>{const a=typeof r.source=="object"?r.source.model:r.source,p=typeof r.target=="object"?r.target.model:r.target;if(!a||!p)return console.warn(`Skipping relation ${r.id||"unnamed"}: missing source or target`),!1;const f=d.has(a),x=d.has(p);if(!f||!x){const y=Array.from(d).find(m=>m.toLowerCase()===a.toLowerCase()),b=Array.from(d).find(m=>m.toLowerCase()===p.toLowerCase());return console.warn(`Skipping relation ${r.id||"unnamed"}: source "${a}" ${f?"found":`(not found${y?`, did you mean "${y}"?`:""})`} or target "${p}" ${x?"found":`(not found${b?`, did you mean "${b}"?`:""})`}`),!1}return!0}),g={...t,elements:o,relations:j,deployments:{elements:{},relations:{}},project:{id:t._metadata?.name||"sruja-project",name:t._metadata?.name||"sruja-project"}};try{return z.fromDump(g)}catch(r){throw console.error("Error creating LikeC4Model:",r),console.error("Model dump:",JSON.stringify(g,null,2)),r}},[t]);return e.jsxs("div",{style:{width:"100%",height:"100%",minHeight:400,position:"relative"},children:[i.length>1&&e.jsx("div",{style:{position:"absolute",top:8,right:8,zIndex:20},children:e.jsx("select",{value:l,onChange:o=>v(o.target.value),style:{padding:"6px 10px",borderRadius:6,border:"1px solid var(--color-border)",background:"var(--color-background)",color:"var(--color-text-primary)",fontSize:12,cursor:"pointer"},children:i.map(o=>e.jsx("option",{value:o,children:t.views?.[o]?.title||o},o))})}),e.jsxs("div",{style:{position:"absolute",top:8,left:8,zIndex:20,padding:"6px 10px",borderRadius:6,border:"1px solid var(--color-border)",background:"var(--color-background)",color:"var(--color-text-secondary)",fontSize:12},children:[u.elements," elements · ",u.relations," relations"]}),e.jsx("div",{style:{width:"100%",height:"100%"},children:e.jsx(R,{viewId:l,fallback:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-secondary)",fontSize:14,padding:"2rem",textAlign:"center"},children:e.jsxs("div",{children:[e.jsxs("p",{children:["Unable to render view ",'"',l,'"']}),e.jsx("p",{style:{fontSize:12,marginTop:"0.5rem",color:"var(--color-text-tertiary)"},children:"The view may not be layouted or the model may not contain layout information."}),i.length>0&&e.jsxs("p",{style:{fontSize:12,marginTop:"0.5rem",color:"var(--color-text-tertiary)"},children:["Available views: ",i.join(", ")]})]})}),children:e.jsx(I,{likec4model:h,children:e.jsx(M,{viewId:l})})})})]})}function J({initialDsl:t}){const[n,i]=s.useState(t),[c,v]=s.useState(null),[l,u]=s.useState(!1),[h,o]=s.useState(null),d=async()=>{u(!0),o(null),w("click","render_button",{component:"playground"});try{const a=(y=>y.replace(/\u2192/g,"->").replace(/[“”]/g,'"').replace(/[’]/g,"'").replace(/\u2013|\u2014/g,"-").split(/\r?\n/).map(m=>m.replace(/^\s*\d+\s*[→:.-]\s?/,"")).join(`
`))(n),f=await(await S()).dslToLikeC4(a),x=JSON.parse(f);v(x),w("success","render_diagram",{component:"playground"})}catch(r){const a=r instanceof Error?r.message:String(r);o(a),C.error("Failed to render diagram",{component:"playground",action:"render",errorType:r instanceof Error?r.constructor.name:"unknown",error:a})}finally{u(!1)}};s.useEffect(()=>{d(),L("live.render_view")},[]);const[j,g]=s.useState(()=>typeof document<"u"&&document.documentElement.getAttribute("data-theme")==="dark"?"vs-dark":"vs");return s.useEffect(()=>{const r=()=>{g(document.documentElement.getAttribute("data-theme")==="dark"?"vs-dark":"vs")};try{window.addEventListener("theme-change",r)}catch{}return()=>{try{window.removeEventListener("theme-change",r)}catch{}}},[]),e.jsxs("div",{style:{border:"1px solid var(--color-border)",borderRadius:8,overflow:"hidden"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr)",gap:0,minHeight:640},children:[e.jsx("div",{style:{borderRight:"1px solid var(--color-border)",position:"relative"},children:e.jsx(k,{value:n,onChange:r=>i(r||""),theme:j,options:{minimap:{enabled:!1},wordWrap:"on",fontSize:14},height:"640px"})}),e.jsxs("div",{style:{position:"relative",height:640},children:[h&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,padding:8,background:"#fee2e2",color:"#b91c1c",fontSize:13,borderBottom:"1px solid #fecaca",zIndex:10},children:["Failed to render: ",h]}),c?e.jsx($,{model:c}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-secondary)"},children:l?e.jsx(E,{size:32}):e.jsx("div",{children:"Click Render to view diagram"})})]})]}),e.jsx("div",{style:{padding:8,display:"flex",gap:8,justifyContent:"flex-end",borderTop:"1px solid var(--color-border)"},children:e.jsx("button",{onClick:()=>{w("click","render_button",{component:"playground"}),d()},disabled:l,style:{padding:"8px 12px",border:"1px solid var(--color-border)",borderRadius:6,background:"var(--color-background)",cursor:"pointer",opacity:l?.7:1},children:l?"Rendering...":"Render Diagram"})})]})}export{J as default};
