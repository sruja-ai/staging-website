import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index._4BMK3ry.js";import"./PosthogProvider.DHrDBjp9.js";import{i as b,l as k,S}from"./SrujaMonacoEditor.CGKiwx36.js";/* empty css                       */import{S as w}from"./SrujaLoader.DoHEjicp.js";import{a as p,t as E}from"./analytics.uhLnXZYd.js";import"./index.CO7ALg8S.js";import"./auto.qXY55obW.js";import"./errorTracking.Bz67025L.js";function z({model:i}){const n=i.elements?Object.values(i.elements):[],s=i.relations||[];return n.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-secondary)"},children:"No elements to display"}):e.jsxs("div",{style:{padding:16,height:"100%",overflow:"auto",background:"var(--color-background-secondary)"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs("strong",{children:["Elements (",n.length,")"]})}),e.jsx("div",{style:{display:"grid",gap:8},children:n.map(r=>e.jsxs("div",{style:{padding:12,background:"var(--color-background)",border:"1px solid var(--color-border)",borderRadius:6},children:[e.jsx("div",{style:{fontWeight:600},children:r.title||r.id}),e.jsxs("div",{style:{fontSize:12,color:"var(--color-text-secondary)"},children:[r.kind," ",r.technology?`• ${r.technology}`:""]}),r.description&&e.jsx("div",{style:{fontSize:13,marginTop:4},children:typeof r.description=="string"?r.description:""})]},r.id))}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:16,marginBottom:8},children:e.jsxs("strong",{children:["Relations (",s.length,")"]})}),e.jsx("div",{style:{display:"grid",gap:4,fontSize:13},children:s.map((r,l)=>e.jsxs("div",{style:{color:"var(--color-text-secondary)"},children:[String(r.source)," → ",String(r.target),r.title?`: ${r.title}`:""]},l))})]})]})}function M({initialDsl:i}){const[n,s]=o.useState(i),[r,l]=o.useState(null),[a,g]=o.useState(!1),[u,m]=o.useState(null),c=o.useCallback(async()=>{g(!0),m(null),p("click","render_button",{component:"playground"});try{const d=(f=>f.replace(/\u2192/g,"->").replace(/[“”]/g,'"').replace(/[’]/g,"'").replace(/\u2013|\u2014/g,"-").split(/\r?\n/).map(j=>j.replace(/^\s*\d+\s*[→:.-]\s?/,"")).join(`
`))(n),y=await(await b()).dslToModel(d),x=JSON.parse(y);l(x),p("success","render_diagram",{component:"playground"})}catch(t){const d=t instanceof Error?t.message:String(t);m(d),k.error("Failed to render diagram",{component:"playground",action:"render",errorType:t instanceof Error?t.constructor.name:"unknown",error:d})}finally{g(!1)}},[n]);o.useEffect(()=>{c(),E("live.render_view")},[c]);const[h,v]=o.useState(()=>typeof document<"u"&&document.documentElement.getAttribute("data-theme")==="dark"?"vs-dark":"vs");return o.useEffect(()=>{const t=()=>{v(document.documentElement.getAttribute("data-theme")==="dark"?"vs-dark":"vs")};try{window.addEventListener("theme-change",t)}catch{}return()=>{try{window.removeEventListener("theme-change",t)}catch{}}},[]),e.jsxs("div",{style:{border:"1px solid var(--color-border)",borderRadius:8,overflow:"hidden"},"data-testid":"viewer-editor",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr)",gap:0,minHeight:640},children:[e.jsx("div",{style:{borderRight:"1px solid var(--color-border)",position:"relative"},children:e.jsx(S,{value:n,onChange:t=>s(t||""),theme:h,options:{minimap:{enabled:!1},wordWrap:"on",fontSize:14},height:"640px"})}),e.jsxs("div",{style:{position:"relative",height:640},children:[u&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,padding:8,background:"#fee2e2",color:"#b91c1c",fontSize:13,borderBottom:"1px solid #fecaca",zIndex:10},children:["Failed to render: ",u]}),r?e.jsx(z,{model:r}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-secondary)"},children:a?e.jsx(w,{size:32}):e.jsx("div",{children:"Click Render to view diagram"})})]})]}),e.jsx("div",{style:{padding:8,display:"flex",gap:8,justifyContent:"flex-end",borderTop:"1px solid var(--color-border)"},children:e.jsx("button",{onClick:()=>{p("click","render_button",{component:"playground"}),c()},disabled:a,style:{padding:"8px 12px",border:"1px solid var(--color-border)",borderRadius:6,background:"var(--color-background)",cursor:"pointer",opacity:a?.7:1},children:a?"Rendering...":"Render Diagram"})})]})}export{M as default};
