import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.BkaWJOLo.js";import"./PosthogProvider.DsEhGCey.js";import{S as b,i as S,l as k}from"./wasmAdapter.CPIXKx3K.js";/* empty css                       */import{S as w}from"./SrujaLoader.CMDi8PfZ.js";import{t as E,a as c}from"./analytics.DTaLZQoP.js";import"./index.Bf_o2Pin.js";import"./auto.qXY55obW.js";import"./modelToDsl.BxOr51Sn.js";function z({model:s}){const n=s.elements?Object.values(s.elements):[],a=s.relations||[];return n.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-secondary)"},children:"No elements to display"}):e.jsxs("div",{style:{padding:16,height:"100%",overflow:"auto",background:"var(--color-background-secondary)"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs("strong",{children:["Elements (",n.length,")"]})}),e.jsx("div",{style:{display:"grid",gap:8},children:n.map(r=>e.jsxs("div",{style:{padding:12,background:"var(--color-background)",border:"1px solid var(--color-border)",borderRadius:6},children:[e.jsx("div",{style:{fontWeight:600},children:r.title||r.id}),e.jsxs("div",{style:{fontSize:12,color:"var(--color-text-secondary)"},children:[r.kind," ",r.technology?`• ${r.technology}`:""]}),r.description&&e.jsx("div",{style:{fontSize:13,marginTop:4},children:typeof r.description=="string"?r.description:""})]},r.id))}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:16,marginBottom:8},children:e.jsxs("strong",{children:["Relations (",a.length,")"]})}),e.jsx("div",{style:{display:"grid",gap:4,fontSize:13},children:a.map((r,l)=>e.jsxs("div",{style:{color:"var(--color-text-secondary)"},children:[String(r.source)," → ",String(r.target),r.title?`: ${r.title}`:""]},l))})]})]})}function M({initialDsl:s}){const[n,a]=o.useState(s),[r,l]=o.useState(null),[d,p]=o.useState(!1),[g,u]=o.useState(null),m=async()=>{p(!0),u(null),c("click","render_button",{component:"playground"});try{const i=(f=>f.replace(/\u2192/g,"->").replace(/[“”]/g,'"').replace(/[’]/g,"'").replace(/\u2013|\u2014/g,"-").split(/\r?\n/).map(j=>j.replace(/^\s*\d+\s*[→:.-]\s?/,"")).join(`
`))(n),y=await(await S()).dslToModel(i),x=JSON.parse(y);l(x),c("success","render_diagram",{component:"playground"})}catch(t){const i=t instanceof Error?t.message:String(t);u(i),k.error("Failed to render diagram",{component:"playground",action:"render",errorType:t instanceof Error?t.constructor.name:"unknown",error:i})}finally{p(!1)}};o.useEffect(()=>{m(),E("live.render_view")},[]);const[h,v]=o.useState(()=>typeof document<"u"&&document.documentElement.getAttribute("data-theme")==="dark"?"vs-dark":"vs");return o.useEffect(()=>{const t=()=>{v(document.documentElement.getAttribute("data-theme")==="dark"?"vs-dark":"vs")};try{window.addEventListener("theme-change",t)}catch{}return()=>{try{window.removeEventListener("theme-change",t)}catch{}}},[]),e.jsxs("div",{style:{border:"1px solid var(--color-border)",borderRadius:8,overflow:"hidden"},"data-testid":"viewer-editor",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr)",gap:0,minHeight:640},children:[e.jsx("div",{style:{borderRight:"1px solid var(--color-border)",position:"relative"},children:e.jsx(b,{value:n,onChange:t=>a(t||""),theme:h,options:{minimap:{enabled:!1},wordWrap:"on",fontSize:14},height:"640px"})}),e.jsxs("div",{style:{position:"relative",height:640},children:[g&&e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,padding:8,background:"#fee2e2",color:"#b91c1c",fontSize:13,borderBottom:"1px solid #fecaca",zIndex:10},children:["Failed to render: ",g]}),r?e.jsx(z,{model:r}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--color-text-secondary)"},children:d?e.jsx(w,{size:32}):e.jsx("div",{children:"Click Render to view diagram"})})]})]}),e.jsx("div",{style:{padding:8,display:"flex",gap:8,justifyContent:"flex-end",borderTop:"1px solid var(--color-border)"},children:e.jsx("button",{onClick:()=>{c("click","render_button",{component:"playground"}),m()},disabled:d,style:{padding:"8px 12px",border:"1px solid var(--color-border)",borderRadius:6,background:"var(--color-background)",cursor:"pointer",opacity:d?.7:1},children:d?"Rendering...":"Render Diagram"})})]})}export{M as default};
