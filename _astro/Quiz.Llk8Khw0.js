import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DM7nOceM.js";function w({quiz:o}){const[a,d]=i.useState(0),[n,p]=i.useState({}),[x,u]=i.useState(!1),s=o.questions[a],c=o.questions.length,l=i.useMemo(()=>o.questions.reduce((r,t)=>r+(n[t.id]===t.answer?1:0),0),[n,o.questions]);i.useEffect(()=>{try{window.dispatchEvent(new CustomEvent("sruja:event",{detail:{type:"quiz.view",slug:o.slug}}))}catch{}},[o.slug]);const m=r=>{p(t=>({...t,[s.id]:r}))},h=()=>{if(a<c-1)d(a+1);else{u(!0);try{window.dispatchEvent(new CustomEvent("sruja:event",{detail:{type:"quiz.complete",slug:o.slug,score:l,total:c}}))}catch{}try{const r=parseInt(localStorage.getItem("sruja-xp")||"0",10)+Math.max(1,l);localStorage.setItem("sruja-xp",String(r))}catch{}}},g=()=>d(Math.max(0,a-1));if(x){const r=Math.round(l/c*100);return e.jsxs("div",{className:"quiz",children:[e.jsx("h2",{children:"Results"}),e.jsxs("p",{children:["Score: ",l,"/",c," (",r,"%)"]}),e.jsx("button",{onClick:()=>{u(!1),d(0),p({})},children:"Retry"})]})}return e.jsxs("div",{className:"quiz",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsx("h2",{children:o.title}),o.summary&&e.jsx("p",{className:"summary",children:o.summary}),e.jsxs("div",{className:"progress",children:["Question ",a+1," of ",c]})]}),e.jsxs("div",{className:"quiz-question",children:[e.jsx("p",{className:"prompt",children:s.prompt}),e.jsx("div",{className:"options",children:s.options.map(r=>{const t=n[s.id]===r.id,v=t&&r.id===s.answer,j=t&&r.id!==s.answer;return e.jsx("button",{className:`option ${t?"selected":""} ${v?"correct":""} ${j?"wrong":""}`,onClick:()=>m(r.id),children:r.label},r.id)})}),n[s.id]&&e.jsxs("div",{className:"feedback",children:[n[s.id]===s.answer?e.jsx("span",{className:"ok",children:"Correct"}):e.jsx("span",{className:"err",children:"Not quite"}),s.explanation&&e.jsx("p",{className:"explain",children:s.explanation})]})]}),e.jsxs("div",{className:"quiz-actions",children:[e.jsx("button",{onClick:g,disabled:a===0,children:"Previous"}),e.jsx("button",{onClick:h,children:a===c-1?"Finish":"Next"})]}),e.jsx("style",{children:`
        .quiz { border: 1px solid var(--color-border); border-radius: 8px; padding: 16px; background: var(--color-background); }
        .quiz-header .summary { color: var(--color-text-secondary); margin: 4px 0 8px; }
        .progress { font-size: 12px; color: var(--color-text-secondary); }
        .prompt { font-weight: 600; }
        .options { display: grid; gap: 8px; margin-top: 8px; }
        .option { padding: 8px 12px; border: 1px solid var(--color-border); border-radius: 6px; background: var(--color-surface); cursor: pointer; text-align: left; }
        .option.selected { border-color: var(--color-primary); background: var(--color-primary-50); }
        .option.correct { border-color: var(--color-success-500); }
        .option.wrong { border-color: var(--color-error-500); }
        .quiz-actions { display: flex; gap: 8px; margin-top: 12px; }
        .feedback { margin-top: 8px; }
        .ok { color: var(--color-success-500); font-weight: 600; }
        .err { color: var(--color-error-500); font-weight: 600; }
        .explain { color: var(--color-text-secondary); margin: 4px 0 0; }
      `})]})}export{w as default};
